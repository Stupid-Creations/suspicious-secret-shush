<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Study Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      --bg:#0f1115; --panel:#151922; --ink:#e6e6e6; --muted:#9aa0aa;
      --btn:#1f2436; --btn-h:#2a3150; --line:#2a2f45;
    }
    body{font-family:system-ui,sans-serif;margin:20px;background:var(--bg);color:var(--ink)}
    h1,h2{margin:0 0 10px 0}
    .nav{margin-bottom:16px}
    .nav button{margin-right:8px}
    .hidden{display:none}
    .card{background:var(--panel);padding:16px;border-radius:14px;margin-bottom:16px;box-shadow:0 10px 24px rgba(0,0,0,.25)}

    /* Heatmap: GitHub-style contribution graph */
    .heatmap-wrap{overflow-x:auto}
    .heatmap-container{display:flex}
    .y-labels{display:grid;grid-template-rows:repeat(7,14px);gap:4px;margin-right:6px;color:var(--muted);font-size:12px}
    .y-labels div{height:14px}
    .heatmap{
      display:grid;
      grid-auto-flow:column;
      grid-template-rows:repeat(7,14px);
      gap:4px;
      align-items:center;
    }
    .cell{width:14px;height:14px;border-radius:3px;background:#161b22}
    .c1{background:#0e4429}.c2{background:#006d32}.c3{background:#26a641}.c4{background:#39d353}

    /* Controls */
    button,select{
      background:linear-gradient(180deg,var(--btn),#1b2033);
      color:var(--ink);border:1px solid var(--line);
      border-radius:10px;padding:8px 12px;cursor:pointer
    }
    button:hover{background:linear-gradient(180deg,var(--btn-h),#222a4a)}
    button:active{transform:translateY(1px)}
    select{margin-right:8px}

    /* Tables */
    table{width:100%;border-collapse:separate;border-spacing:0 6px}
    thead th{color:var(--muted);font-weight:600;text-align:left;padding:6px 10px}
    tbody tr{background:#111527}
    tbody td{padding:10px;border-top:1px solid var(--line);border-bottom:1px solid var(--line)}
    tbody tr td:first-child{border-left:1px solid var(--line);border-radius:10px 0 0 10px}
    tbody tr td:last-child{border-right:1px solid var(--line);border-radius:0 10px 10px 0}
    .num{text-align:right;font-variant-numeric:tabular-nums}

    /* Tracker */
    #timer{font-size:20px;font-variant-numeric:tabular-nums;color:#cfe3ff}
  </style>
</head>
<body>
  <h1>Study Tracker</h1>
  <div class="nav">
    <button onclick="show('home')">Home</button>
    <button onclick="show('track')">Track Session</button>
  </div>

  <div id="home" class="page">
    <div class="card">
      <h2>Questions Solved</h2>
      <div class="heatmap-wrap">
        <div id="heatmap" class="heatmap"></div>
      </div>
    </div>

    <div class="card"><canvas id="accuracyChart"></canvas></div>
    <div class="card"><canvas id="timeChart"></canvas></div>

    <div class="card">
      <h2>Subject Averages</h2>
      <table>
        <thead>
          <tr><th>Subject</th><th class="num">Accuracy</th><th class="num">Mean time / Q</th></tr>
        </thead>
        <tbody id="subjectStats"></tbody>
      </table>
    </div>
  </div>

  <div id="track" class="page hidden">
    <div class="card">
      <h2>Track Question</h2>
      <select id="subject"></select>
      <button onclick="startTimer()">Start</button>
      <button onclick="stopTimer(true)">Correct</button>
      <button onclick="stopTimer(false)">Incorrect</button>
      <p id="timer">0.0 s</p>
    </div>

    <div class="card">
      <h2>Session Stats</h2>
      <p id="sessionStats"></p>
      <p id="outliers"></p>
    </div>
  </div>

<script>
const store = JSON.parse(localStorage.getItem('studyData')||'{}')
if(!store.days) store.days={}
if(!store.subjects) store.subjects={}
if(!store.subjectList) store.subjectList=['Physics','Maths','Chemistry']
localStorage.setItem('studyData',JSON.stringify(store))

const today=()=>new Date().toISOString().slice(0,10)
const DAY=864e5
function save(){ localStorage.setItem('studyData',JSON.stringify(store)) }
function show(p){ document.querySelectorAll('.page').forEach(x=>x.classList.add('hidden')); document.getElementById(p).classList.remove('hidden') }

function recordQuestion(subj,time,correct){
  const d=today()
  store.days[d]=store.days[d]||[]
  store.days[d].push({subj,time,correct})
  store.subjects[subj]=store.subjects[subj]||[]
  store.subjects[subj].push({time,correct,date:d})
  save()
}

// Compact multi-month heatmap (last 90 days)
function buildHeatmap(){
  const el=document.getElementById('heatmap'); el.innerHTML=''
  const DAYS=90
  for(let i=DAYS-1;i>=0;i--){
    const d=new Date(Date.now()-i*DAY).toISOString().slice(0,10)
    const c=(store.days[d]||[]).length
    const cell=document.createElement('div')
    cell.className='cell '+(c>0?'c'+Math.min(4,Math.ceil(c/5)):'')
    cell.title=`${d}: ${c} questions`
    el.appendChild(cell)
  }
}

function subjectStats(){
  const t=document.getElementById('subjectStats'); t.innerHTML=''
  for(const s of store.subjectList){
    const arr=store.subjects[s]||[]
    if(!arr.length){
      t.innerHTML+=`<tr><td>${s}</td><td class="num">—</td><td class="num">—</td></tr>`
      continue
    }
    const acc=arr.filter(x=>x.correct).length/arr.length
    const mean=arr.reduce((a,b)=>a+b.time,0)/arr.length
    t.innerHTML+=`<tr><td>${s}</td><td class="num">${(acc*100).toFixed(1)}%</td><td class="num">${mean.toFixed(1)} s</td></tr>`
  }
}

function charts(){
  const days=[...Array(7)].map((_,i)=>new Date(Date.now()-(6-i)*DAY).toISOString().slice(0,10))
  const datasetsAcc=[], datasetsTime=[]
  for(const s of store.subjectList){
    const acc=days.map(d=>{const a=(store.days[d]||[]).filter(x=>x.subj===s);return a.length?a.filter(x=>x.correct).length/a.length:0})
    const time=days.map(d=>{const a=(store.days[d]||[]).filter(x=>x.subj===s);return a.length?a.reduce((t,x)=>t+x.time,0):0})
    datasetsAcc.push({label:s,data:acc})
    datasetsTime.push({label:s,data:time})
  }
  new Chart(accuracyChart,{
    type:'line',
    data:{labels:days,datasets:datasetsAcc},
    options:{
      plugins:{
        title:{display:true,text:'Accuracy per Day (by Subject)',color:'#e6e6e6',font:{size:14}}
      },
      scales:{y:{min:0,max:1}}
    }
  })
  new Chart(timeChart,{
    type:'bar',
    data:{labels:days,datasets:datasetsTime},
    options:{
      plugins:{
        title:{display:true,text:'Time Spent per Day (by Subject)',color:'#e6e6e6',font:{size:14}}
      }
    }
  })
}

let start=0, tick=null, session=[], out=0
function startTimer(){
  start=performance.now()
  clearInterval(tick)
  tick=setInterval(()=>{timer.textContent=((performance.now()-start)/1000).toFixed(1)+' s'},100)
}
function stopTimer(correct){
  if(!start) return
  clearInterval(tick)
  const t=(performance.now()-start)/1000
  start=0
  const subj=subject.value
  if(t>5*60){ out++; updateSession(); return }
  recordQuestion(subj,t,correct)
  session.push({t,correct})
  updateSession()
}
function updateSession(){
  const m=session.reduce((a,b)=>a+b.t,0)/Math.max(1,session.length)
  const a=session.filter(x=>x.correct).length/Math.max(1,session.length)
  sessionStats.textContent=`Questions: ${session.length}, Mean time: ${m.toFixed(1)} s, Accuracy: ${(a*100).toFixed(1)}%`
  outliers.textContent=`Outliers (>5 min): ${out}`
}

function init(){
  subject.innerHTML=store.subjectList.map(s=>`<option>${s}</option>`).join('')
  buildHeatmap(); subjectStats(); charts()
}
init()
</script>
</body>
</html>
