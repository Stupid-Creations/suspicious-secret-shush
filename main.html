<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Study Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: system-ui, sans-serif; margin: 20px; background:#0f1115; color:#e6e6e6 }
    h1,h2 { margin-top: 0 }
    .nav button { margin-right: 8px }
    .hidden { display:none }
    .card { background:#151922; padding:16px; border-radius:12px; margin-bottom:16px }
    .heatmap { display:grid; grid-template-columns: repeat(7, 1fr); gap:4px }
    .cell { height:18px; border-radius:3px; background:#222 }
    .c1{background:#1e4423}.c2{background:#2e7d32}.c3{background:#4caf50}.c4{background:#81c784}
    table { width:100%; border-collapse:collapse }
    td,th { padding:6px; border-bottom:1px solid #333 }
    input,select,button { background:#1c2030; color:#e6e6e6; border:1px solid #333; border-radius:6px; padding:6px }
  </style>
</head>
<body>
  <h1>Study Tracker</h1>
  <div class="nav">
    <button onclick="show('home')">Home</button>
    <button onclick="show('track')">Track Session</button>
  </div>

  <div id="home" class="page">
    <div class="card">
      <h2>Questions Solved (Last 7 Days)</h2>
      <div id="heatmap" class="heatmap"></div>
    </div>

    <div class="card"><canvas id="accuracyChart"></canvas></div>
    <div class="card"><canvas id="timeChart"></canvas></div>

    <div class="card">
      <h2>Subject Averages</h2>
      <table id="subjectStats"></table>
    </div>
  </div>

  <div id="track" class="page hidden">
    <div class="card">
      <h2>Track Question</h2>
      <select id="subject"></select>
      <button onclick="startTimer()">Start</button>
      <button onclick="stopTimer(true)">Correct</button>
      <button onclick="stopTimer(false)">Incorrect</button>
      <p id="timer">0.0 s</p>
    </div>

    <div class="card">
      <h2>Session Stats</h2>
      <p id="sessionStats"></p>
      <p id="outliers"></p>
    </div>
  </div>

<script>
const store = JSON.parse(localStorage.getItem('studyData')||'{}')
if(!store.days) store.days={}
if(!store.subjects) store.subjects={}
if(!store.subjectList) store.subjectList=['Physics','Maths','Chemistry']
localStorage.setItem('studyData',JSON.stringify(store))

const today=()=>new Date().toISOString().slice(0,10)

function save(){ localStorage.setItem('studyData',JSON.stringify(store)) }

function show(p){ document.querySelectorAll('.page').forEach(x=>x.classList.add('hidden')); document.getElementById(p).classList.remove('hidden') }

function recordQuestion(subj,time,correct){
  const d=today()
  store.days[d]=store.days[d]||[]
  store.days[d].push({subj,time,correct})
  store.subjects[subj]=store.subjects[subj]||[]
  store.subjects[subj].push({time,correct})
  save()
}

function buildHeatmap(){
  const el=document.getElementById('heatmap'); el.innerHTML=''
  for(let i=6;i>=0;i--){
    const d=new Date(Date.now()-i*864e5).toISOString().slice(0,10)
    const c=(store.days[d]||[]).length
    const cell=document.createElement('div')
    cell.className='cell '+(c>0?'c'+Math.min(4,Math.ceil(c/5)):'')
    el.appendChild(cell)
  }
}

function subjectStats(){
  const t=document.getElementById('subjectStats'); t.innerHTML='<tr><th>Subject</th><th>Accuracy</th><th>Mean Time/Q</th></tr>'
  for(const s in store.subjects){
    const arr=store.subjects[s]
    const acc=arr.filter(x=>x.correct).length/arr.length
    const mean=arr.reduce((a,b)=>a+b.time,0)/arr.length
    t.innerHTML+=`<tr><td>${s}</td><td>${(acc*100).toFixed(1)}%</td><td>${mean.toFixed(1)}s</td></tr>`
  }
}

function charts(){
  const days=[...Array(7)].map((_,i)=>new Date(Date.now()-(6-i)*864e5).toISOString().slice(0,10))
  const acc=days.map(d=>{const a=store.days[d]||[];return a.length?a.filter(x=>x.correct).length/a.length:0})
  const time=days.map(d=>{const a=store.days[d]||[];return a.length?a.reduce((s,x)=>s+x.time,0):0})
  new Chart(accuracyChart,{type:'line',data:{labels:days,datasets:[{label:'Accuracy',data:acc}]}})
  new Chart(timeChart,{type:'bar',data:{labels:days,datasets:[{label:'Time Spent (s)',data:time}]}})
}

let start=0, session=[], out=0
function startTimer(){ start=performance.now(); timer.textContent='0.0 s' }
function stopTimer(correct){
  if(!start) return
  const t=(performance.now()-start)/1000
  start=0
  const subj=subject.value
  if(t>5*60){ out++; updateSession(); return }
  recordQuestion(subj,t,correct)
  session.push({t,correct})
  updateSession()
}

function updateSession(){
  const m=session.reduce((a,b)=>a+b.t,0)/Math.max(1,session.length)
  const a=session.filter(x=>x.correct).length/Math.max(1,session.length)
  sessionStats.textContent=`Questions: ${session.length}, Mean time: ${m.toFixed(1)}s, Accuracy: ${(a*100).toFixed(1)}%`
  outliers.textContent=`Outliers (>5 min): ${out}`
}

function init(){
  subject.innerHTML=store.subjectList.map(s=>`<option>${s}</option>`).join('')
  buildHeatmap(); subjectStats(); charts()
}
init()
</script>
</body>
</html>
